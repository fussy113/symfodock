version: '2'

services:
    workspace:
      build: "./php53-apache"
      # ports でポートフォワーディングを指定.
      ports:
        - "${PORT}:${PORT}"
      # volumes でマウントの指定.こちらも相対パス.
      volumes:
        - ./workspace:/var/www/html
        - ./php53-apache/httpd.conf:/etc/httpd/conf/httpd.conf
        - ./logs/symfony/:/var/log/httpd/
      # links で連携させるコンテナを示す.
      # depends_onはビルド時に依存関係を考慮してビルドさせるために指定.
      # links は appコンテナの/etc/hostsにdbのipを記述してくれる.
      links:
        - postgres:postgres

    postgres:
      restart: always
      image: postgres:9.6.12-alpine
      environment:
        LC_ALL: C.UTF-8
        POSTGRES_USER: ${POSTGRES_USER}
        POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      volumes:
        - ./pgsql-data:/var/lib/postgresql/data
      ports:
        - "${DB_PORT}:${DB_PORT}"
